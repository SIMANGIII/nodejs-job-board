<%- include('partials/header') %>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card p-4 mb-4">
                <form action="/" method="GET">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <input type="text" name="keyword" class="form-control" placeholder="Keywords" value="<%= req.query.keyword || '' %>">
                        </div>
                        <div class="col-md-6">
                            <input type="text" name="location" class="form-control" placeholder="Location" value="<%= req.query.location || '' %>">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="jobTypes" id="advert" value="Advert" <%= (!req.query.jobTypes || (req.query.jobTypes && req.query.jobTypes.includes('Advert'))) ? 'checked' : '' %>>
                                <label class="form-check-label" for="advert">Advert</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="jobTypes" id="consultancy" value="Consultancy" <%= (!req.query.jobTypes || (req.query.jobTypes && req.query.jobTypes.includes('Consultancy'))) ? 'checked' : '' %>>
                                <label class="form-check-label" for="consultancy">Consultancy</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="jobTypes" id="contract" value="Contract" <%= (!req.query.jobTypes || (req.query.jobTypes && req.query.jobTypes.includes('Contract'))) ? 'checked' : '' %>>
                                <label class="form-check-label" for="contract">Contract</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="jobTypes" id="fullTime" value="Full Time" <%= (!req.query.jobTypes || (req.query.jobTypes && req.query.jobTypes.includes('Full Time'))) ? 'checked' : '' %>>
                                <label class="form-check-label" for="fullTime">Full Time</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="jobTypes" id="internship" value="Internship" <%= (!req.query.jobTypes || (req.query.jobTypes && req.query.jobTypes.includes('Internship'))) ? 'checked' : '' %>>
                                <label class="form-check-label" for="internship">Internship</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="jobTypes" id="partTime" value="Part Time" <%= (!req.query.jobTypes || (req.query.jobTypes && req.query.jobTypes.includes('Part Time'))) ? 'checked' : '' %>>
                                <label class="form-check-label" for="partTime">Part Time</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="jobTypes" id="rfpTender" value="RFP / Tender" <%= (!req.query.jobTypes || (req.query.jobTypes && req.query.jobTypes.includes('RFP / Tender'))) ? 'checked' : '' %>>
                                <label class="form-check-label" for="rfpTender">RFP / Tender</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="jobTypes" id="temporary" value="Temporary" <%= (!req.query.jobTypes || (req.query.jobTypes && req.query.jobTypes.includes('Temporary'))) ? 'checked' : '' %>>
                                <label class="form-check-label" for="temporary">Temporary</label>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <button type="submit" class="btn btn-dark w-100">Search Jobs</button>
                        </div>
                    </div>
                </form>
            </div>

            <div id="job-listings">
                <%- include('partials/_jobs', {jobs: jobs, isAdmin: false}) %>
            </div>

            <% if (hasMore) { %>
            <div class="text-center mt-4">
                <button id="see-more-btn" class="btn btn-primary">See More</button>
            </div>
            <% } %>
        </div>
    </div>
</div>

<script>
    const seeMoreBtn = document.getElementById('see-more-btn');
    const jobListings = document.getElementById('job-listings');
    let loaded = <%= loaded %>;

    if (seeMoreBtn) {
        seeMoreBtn.addEventListener('click', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set('loaded', loaded);
            urlParams.set('ajax', 'true');
            const response = await fetch(`/?${urlParams.toString()}`);
            const newJobsHtml = await response.text();

            jobListings.insertAdjacentHTML('beforeend', newJobsHtml);

            loaded += 10; // Assuming limit is 10, as per backend

            // Check if there are more jobs by checking if the response is empty
            if (newJobsHtml.trim() === '') {
                seeMoreBtn.style.display = 'none';
            }
        });
    }
</script>

<%- include('partials/footer') %>